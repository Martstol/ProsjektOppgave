\section{Setup}

This section will describe the compilation of PETSc and the snow simulator as well 
as the hardware and software of the workstation used for the tests in the next section. 

\subsection{Workstation}

% Petsc required cuda version 5, cuda version 5 required ubuntu version 11.10, which was
% installed on a workstation with the following setup:

\begin{table}[h]
	\begin{center}
	\bgroup
	\def\arraystretch{1.2}
	\begin{tabular}{|l|l|}
		\hline
		\multicolumn{2}{|l|}{\textbf{Workstation hardware}} \\ \hline
		CPU & i7-930 @ 2.8 GHz \\ \hline
		GPU 1 & Nvidia GeForce GTX 460 \\ \hline
		GPU 2 & Nvidia Tesla C2050 \\ \hline
		Memory & 10 GB DDR3 1333 MHz \\ \hline
		Power supply & MIST AX1000 \\ \hline
		\multicolumn{2}{|l|}{\textbf{Workstation software}} \\ \hline
		Operating system & Ubuntu 11.10 64-bit \\ \hline
		Nvidia driver & 304.54 \\ \hline
		CUDA toolkit & 5.0 \\ \hline
		g++ & 4.6.1 \\ \hline
		gcc & 4.6.1 \\ \hline
		PETSc & development version \\ \hline
	\end{tabular}
	\egroup
	\end{center}
	\caption{Specifications of the workstation used for testing PETSc with CUDA.}
	\label{table:test_pc}
\end{table}

TODO: Rewrite below, that is the development and testing without petsc+cuda setup

This project was only tested on one workstation. Table \ref{table:dev_pc} contains 
the specifications for the workstation used.

\begin{table}[h]
	\begin{center}
	\bgroup
	\def\arraystretch{1.2}
	\begin{tabular}{|l|l|}
		\hline
		\multicolumn{2}{|l|}{\textbf{Workstation hardware}} \\ \hline
		CPU & i7-3770 @ 3.4 GHz \\ \hline
		GPU & Nvidia GeForce GTX 980 \\ \hline
		Memory & 16 GB DDR3 1600 MHz \\ \hline
		Power supply & CORSAIR AX1200 \\ \hline
		\multicolumn{2}{|l|}{\textbf{Workstation software}} \\ \hline
		Operating system & Ubuntu 14.04 64-bit \\ \hline
		Nvidia driver & 343.22 \\ \hline
		CUDA toolkit & 6.5 \\ \hline
		g++ & 4.8.2 \\ \hline
		gcc & 4.8.2 \\ \hline
		PETSc & 3.5.2 \\ \hline
	\end{tabular}
	\egroup
	\end{center}
	\caption{Specifications of the workstation used for development and testing PETSc without CUDA.}
	\label{table:dev_pc}
\end{table}

\subsection{PETSc}

PETSc was acquired from the PETSc Web Page\cite{petsc-web-page} as version 3.5.2. 
The version of the compilers used when configuring PETSc can be found in table 
\ref{table:dev_pc}.

\subsubsection{Development configuration}

For development, PETSc was configured with the following flags:
\lstset{language=bash}
\begin{lstlisting}
./configure --with-cc=gcc --with-cxx=g++ --with-fc=0 
--download-f2cblaslapack --download-mpich
\end{lstlisting}
Debugging is by default enabled by the PETSc configuration, therefore the debug 
flag is not being specified.

\subsubsection{Testing configuration}

To use PETSc's GPU features, it is recommended to use the current development 
version of PETSc. Therefore PETSc was obtained from PETSc's bitbucket repository
\footnote{https://bitbucket.org/petsc/petsc}. Petsc was then configured as follows:
\lstset{language=bash}
\begin{lstlisting}
./configure --with-cc=gcc --with-cxx=g++ --with-fc=0
--with-debugging=0 --with-precision=single
COPTFLAGS='-O3' CXXOPTFLAGS='-O3' 
--download-f2cblaslapack --download-mpich
--with-cuda=1 --with-cuda-dir=/usr/local/cuda-6.5 
--with-cuda-arch=sm_50 --with-cusp=1 --download-cusp=yes
\end{lstlisting}
For this configuration of PETSc debugging was disabled and precision was set to 
single. This is because single precision is faster and some GPUs may not support 
double precision. The rest of the snow simulator also uses single precision.

The CUDA installation is located in the folder \emph{/usr/local/cuda-6.5}. The 
cuda architecture was set to \emph{sm\_50}. PETSc did not accept \emph{sm\_52}, 
which is the compute capability of the GTX 980. 

\subsection{Compilation}

